---
layout: header
---

<head>
    <!-- Preloading fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style"
        type="text/css" crossorigin>
</head>

<style>
    /* Styling for stats container */
    .stats-container {
        /* Background and box styling */
    }

    /* Styling for betting container */
    .betting-container {
        /* Background and box styling */
    }

    /* Styling for headings */
    h1, h2 {
        color: #27ae60;
        margin-bottom: 25px;
    }

    /* Styling for labels, inputs, buttons, paragraphs, and divs */
    label, input, button, p, div {
        /* Common margins */
    }

    /* Styling for input and button elements */
    input, button {
        /* Common padding, border, and background color */
    }

    /* Additional styling for input elements */
    input {
        /* Background and text color */
    }

    /* Styling for buttons */
    button {
        /* Background, text color, border, and cursor */
        /* Font weight and size */
        /* Transition effect */
    }

    /* Hover effect for buttons */
    button:hover {
        /* Background color on hover */
    }

    /* Styling for stats display */
    #statsDisplay {
        /* Text alignment, background, border, border-radius, padding, and margin */
    }

    /* Focus effect for input and button elements */
    input:focus, button:focus {
        /* Remove outline and change border color on focus */
    }

    /* Styling for game divs */
    .game {
        /* Margin, padding, background color, and border radius */
        /* Text alignment */
    }

    /* Styling for bet buttons */
    .bet-button {
        /* Background, text color, border, padding, border radius, and cursor */
        /* Margin top */
    }

    /* Hover effect for bet buttons */
    .bet-button:hover {
        /* Background color on hover */
    }

    /* Styling for cash display */
    .cash-display {
        /* Text alignment and margin top */
    }

    /* Styling for flex container */
    .flex-container {
        /* Display, flex wrap, justify content, width, list style, padding, and margin */
    }

    /* Styling for each flex container item */
    .flex-container>li {
        /* Width and margin bottom */
    }
</style>

<body>

    <!-- Page title -->
    <h1 style="margin-top: 100px; text-align: center;">
        Stats for the User & Betting
    </h1>

    <!-- Flex container for stats and betting sections -->
    <ul class="flex-container">
        <!-- Container for user stats -->
        <li class="stats-container">
            <!-- Heading for user stats -->
            <h1>User Stats</h1>
            <!-- Username input -->
            <label for="username">Username:</label>
            <input type="text" id="username" readonly>

            <!-- Buttons to fetch user cash and eco score -->
            <button onclick="fetchCash()">Get Cash</button>
            <button onclick="fetchEco()">Get Eco Score</button>

            <!-- Heading for updating stats -->
            <h2>Update Stats</h2>
            <!-- Input and button to update cash -->
            <input type="number" id="updateCash" placeholder="New Cash Value">
            <button onclick="updateCash()">Update Cash</button>

            <!-- Input and button to update eco score -->
            <input type="number" id="updateEco" placeholder="New Eco Score">
            <button onclick="updateEco()">Update Eco Score</button>

            <!-- Heading for comparing stats -->
            <h2>Compare Stats</h2>
            <!-- Input and button to compare stats -->
            <input type="text" id="compareUsername" placeholder="Username to Compare">
            <button onclick="compareStats()">Compare</button>

            <!-- Container to display stats comparison result -->
            <div id="statsDisplay"></div>
        </li>

        <!-- Container for sports betting -->
        <li class="betting-container">
            <!-- Heading for sports betting -->
            <h1>Sports Betting</h1>
            <!-- Display for user's remaining cash -->
            <div class="cash-display">Cash Remaining: <span id="cashAmount">$0</span></div>

            <!-- NBA Betting -->
            <div class="game">
                <!-- Heading for NBA game betting -->
                <h2>NBA Game Betting</h2>
                <!-- Input and button for betting on Lakers vs. Celtics -->
                <h3>Lakers vs. Celtics</h3>
                <input type="number" class="bet-input" id="betAmountNBA1" placeholder="Bet Amount">
                <button class="bet-button" onclick="placeBet('Lakers vs. Celtics', document.getElementById('betAmountNBA1').value)">Bet</button>

                <!-- Input and button for betting on Nets vs. Bucks -->
                <h3>Nets vs. Bucks</h3>
                <input type="number" class="bet-input" id="betAmountNBA2" placeholder="Bet Amount">
                <button class="bet-button" onclick="placeBet('Nets vs. Bucks', document.getElementById('betAmountNBA2').value)">Bet</button>
            </div>

            <!-- March Madness Betting -->
            <div class="game">
                <!-- Heading for March Madness game betting -->
                <h2>March Madness Betting</h2>
                <!-- Input and button for betting on Gonzaga vs. Baylor -->
                <h3>Gonzaga vs. Baylor</h3>
                <input type="number" class="bet-input" id="betAmountMM1" placeholder="Bet Amount">
                <button class="bet-button" onclick="placeBet('Gonzaga vs. Baylor', document.getElementById('betAmountMM1').value)">Bet</button>

                <!-- Input and button for betting on Michigan vs. UCLA -->
                <h3>Michigan vs. UCLA</h3>
                <input type="number" class="bet-input" id="betAmountMM2" placeholder="Bet Amount">
                <button class="bet-button" onclick="placeBet('Michigan vs. UCLA', document.getElementById('betAmountMM2').value)">Bet</button>
            </div>

            <!-- NCAA Betting -->
            <div class="game">
                <!-- Heading for NCAA game betting -->
                <h2>NCAA Betting</h2>
                <!-- Input and button for betting on Duke vs. North Carolina -->
                <h3>Duke vs. North Carolina</h3>
                <input type="number" class="bet-input" id="betAmountNCAA1" placeholder="Bet Amount">
                <button class="bet-button" onclick="placeBet('Duke vs. North Carolina', document.getElementById('betAmountNCAA1').value)">Bet</button>

                <!-- Input and button for betting on Kentucky vs. Kansas -->
                <h3>Kentucky vs. Kansas</h3>
                <input type="number" class="bet-input" id="betAmountNCAA2" placeholder="Bet Amount">
                <button class="bet-button" onclick="placeBet('Kentucky vs. Kansas', document.getElementById('betAmountNCAA2').value)">Bet</button>
            </div>
        </li>
</ul>

    <script>
        const apiUrl = 'http://localhost:6942/api/person';
        const userEmail = localStorage.getItem('userEmail');
        document.getElementById('username').value = userEmail || 'No username found';

        async function fetchCash() {
            const displayCash = document.getElementById('cashAmount');
            try {
                const response = await fetch(`${apiUrl}/getCash`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail })
                });
                if (!response.ok) throw new Error('Network response was not ok.');

                const cash = await response.text(); // Assuming response is plain text
                displayCash.textContent = `$${cash}`;
            } catch (error) {
                console.error('Error:', error);
                displayCash.textContent = '$0'; // Reset cash to $0 if an error occurs
            }
        }

        async function fetchEco() {
            const displayEco = document.getElementById('ecoScore');
            try {
                const response = await fetch(`${apiUrl}/getEco`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail })
                });
                if (!response.ok) throw new Error('Network response was not ok.');

                const eco = await response.text(); // Assuming response is plain text
                displayEco.textContent = eco;
            } catch (error) {
                console.error('Error:', error);
                displayEco.textContent = '0'; // Reset eco score to 0 if an error occurs
            }
        }

        async function updateCash() {
            const newCash = document.getElementById('updateCash').value;

            console.log(newCash)
            if (!userEmail || newCash === '') {
                document.getElementById('statsDisplay').innerText = 'Missing username or new cash value.';
                return;
            }

            const data = {
                email: userEmail,
                cash: parseInt(newCash, 10) // Ensure cash is sent as an integer
            };

            try {
                const response = await fetch(`${apiUrl}/cashUpdate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error(`Server responded with ${response.status}`);

                const result = await response.text(); // Assuming response is plain text
                console.log(result)
                document.getElementById('statsDisplay').innerText = result;

                // Update cash in localStorage
                localStorage.setItem('userCash', newCash);
                // Update displayed cash amount
                document.getElementById('cashAmount').textContent = `$${newCash}`;
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('statsDisplay').innerText = `Failed to update cash. Error: ${error.message}`;
            }
        }


        async function updateEco() {
            const newEco = document.getElementById('updateEco').value;
            if (!userEmail || newEco === '') {
                document.getElementById('statsDisplay').innerText = 'Missing username or new eco score.';
                return;
            }

            const data = {
                email: userEmail,
                eco: parseInt(newEco, 10) // Ensure eco is sent as an integer
            };

            try {
                const response = await fetch(`${apiUrl}/ecoUpdate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error(`Server responded with ${response.status}`);

                const result = await response.text(); // Assuming response is plain text
                document.getElementById('statsDisplay').innerText = result;
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('statsDisplay').innerText = `Failed to update eco. Error: ${error.message}`;
            }
        }

        async function compareStats() {
            const compareUsername = document.getElementById('compareUsername').value;
            const displayDiv = document.getElementById('statsDisplay');
            if (!compareUsername) {
                displayDiv.innerText = 'Please enter a username to compare.';
                return;
            }

            try {
                const currentStats = await fetch(`${apiUrl}/post`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail })
                }).then(res => res.json());

                const compareStats = await fetch(`${apiUrl}/post`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: compareUsername })
                }).then(res => res.json());

                displayDiv.innerHTML = `
                    <p><strong>${userEmail}</strong> vs <strong>${compareUsername}</strong></p>
                    <p>Cash: ${currentStats.cash} vs ${compareStats.cash}</p>
                    <p>Eco Score: ${currentStats.eco} vs ${compareStats.eco}</p>
                `;
            } catch (error) {
                console.error('Error:', error);
                displayDiv.innerText = 'Failed to compare stats. Please try again.';
            }
        }

        async function placeBet(gameName) {
            const betAmountInput = prompt(`Enter the bet amount for ${gameName}:`);
            const betAmount = parseFloat(betAmountInput);
            if (isNaN(betAmount) || betAmount <= 0) {
                alert('Invalid bet amount');
                return;
            }

            const confirmBet = confirm(`Place a $${betAmount.toFixed(2)} bet on ${gameName}?`);
            if (confirmBet) {
                try {
                    const response = await fetch(`${apiUrl}/getCash`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: userEmail })
                    });
                    if (!response.ok) throw new Error('Failed to fetch user cash');

                    const userCashStr = await response.text();

                    let userCash = parseFloat(userCashStr);
                    if (isNaN(userCash)) {
                        throw new Error('Invalid user cash');
                    }
                    if (userCash < betAmount) {
                        throw new Error('Insufficient funds');
                    }

                    console.log(userCash)

                    var newCash = userCash - betAmount;
                    


                    if (!userEmail || newCash === '') {
                        document.getElementById('statsDisplay').innerText = 'Missing username or new cash value.';
                        return;
                    }

                    const data = {
                        email: userEmail,
                        cash: parseInt(newCash, 10) // Ensure cash is sent as an integer
                    };

                    try {
                        const response = await fetch(`${apiUrl}/cashUpdate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });

                        if (!response.ok) throw new Error(`Server responded with ${response.status}`);

                        const result = await response.text(); // Assuming response is plain text
                        document.getElementById('statsDisplay').innerText = result;

                        // Update cash in localStorage
                        localStorage.setItem('userCash', newCash);
                        // Update displayed cash amount
                        document.getElementById('cashAmount').textContent = `$${newCash}`;
                    } catch (error) {
                        console.error('Error:', error);
                        document.getElementById('statsDisplay').innerText = `Failed to update cash. Error: ${error.message}`;
                    }
                    alert(`You placed a $${betAmount.toFixed(2)} bet on ${gameName}. Remaining cash: $${newCash.toFixed(2)}`);
                } catch (error) {
                    alert('Failed to place bet: ' + error.message);
                }
            }
        }
        
        
        
        
                
        
        
        

        if (userEmail) {
            fetchCash(); // Automatically fetch cash on page load
        }
    </script>
</body>

</html>
