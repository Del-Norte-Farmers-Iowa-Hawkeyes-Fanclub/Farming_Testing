<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <h1>SHOP</h1>
</head>
<body>
    <div id = 'return'>
        <button id = 'home', onclick="myFunction()">Return to Home</button>
    </div>

    <button = 'cornSell', onclick="sellCorn()">Sell Your Corn</button>
</body>

<script>
    var pricePerCorn = 0;
    const cornQuant = localStorage.getItem('cornStorage');
    const mailE = localStorage.getItem('email');
    function myFunction(){
        document.getElementById("home");
         window.location.href = '/game.html';
         console.log(pricePerCorn + " ppc");
    }
    
    function updateCash(email, cash) {
        fetch('http://localhost:6942/api/person/cashUpdate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: email,
                cash: cash
            })
        })
        .then(response => {
            if (response.ok) {
                console.log('Cash updated successfully');
            } else {
                console.error('Failed to update cash');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function updateCash(email, cash) {
        fetch('http://localhost:6942/api/person/cashUpdate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: email,
                cash: cash
            })
        })
        .then(response => {
            if (response.ok) {
                console.log('Cash updated successfully ' + cash);
            } else {
                console.error('Failed to update cash');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function calculateCornPrice(callback) {
        // getting corn futures price
        var name = 'Corn Futures'
        $.ajax({
        method: 'GET',
        url: 'https://api.api-ninjas.com/v1/commodityprice?name=' + name,
        headers: { 'X-Api-Key': 'SfcAe601qaPJvg1Dmy6kmg==XeVguO0mmdWet9h3'},
        contentType: 'application/json',
        success: function(result) {
            console.log(result);
            console.log(result.price);
            pricePerCorn = result.price;
            console.log(pricePerCorn);
            if(callback){
                callback(pricePerCorn);
            }
        },
        error: function ajaxError(jqXHR) {
            console.error('Error: ', jqXHR.responseText);
        }
        
    });
    
    }
    function sellCorn(){
          console.log("corn: " + cornQuant);
          calculateCornPrice(function(pricePerCorn){
              console.log("I LOVE PPC: " + pricePerCorn);
              updateCash(localStorage.getItem('email'), (pricePerCorn * cornQuant));
          });
          localStorage.setItem('cornStorage', 0);
      }
      
</script>